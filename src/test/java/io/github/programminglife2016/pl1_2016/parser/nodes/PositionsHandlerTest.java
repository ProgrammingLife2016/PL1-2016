package io.github.programminglife2016.pl1_2016.parser.nodes;

import org.junit.Before;
import org.junit.Test;

import java.io.ByteArrayInputStream;
import java.io.InputStream;
import java.nio.charset.StandardCharsets;

import static org.junit.Assert.assertEquals;

/**
 * Created by ravishivam on 13-5-16.
 */
public class PositionsHandlerTest {
    private String file = "H\tVN:Z:1.0\n" +
            "H\tORI:Z:MT_H37RV_BRD_V5.ref.fasta;TKK_02_0001.fasta;TKK_02_0002.fasta;TKK_02_0004.fasta;TKK_02_0005.fasta;TKK_02_0006.fasta;TKK_02_0007.fasta;TKK_02_0008.fasta;TKK_02_0010.fasta;TKK_02_0018.fasta;TKK_02_0025.fasta;\n" +
            "S\t1\tTTGACCGATGACCCCGGTTCAGGCTTCACCACAGTGTGGAACGCGGTCGTCTCCGAACTTAACGGCGACCCTAAGGTTGACGACGGACCCAGCAGTGATGCTAATCTCAGCGCTCCGCTGACCCCTCAGCAAAGGGCTTGGCTCAATCTCGTCCAGCCATTGACCATCGTCGAGGGGTTTGCTCTGTTATCCGTGCCGAGCAGCTTTGTCCAAAACGAAATCGAGCGCCATCTGCGGGCCCCGATTACCGACGCTCTCAGCCGCCGACTCGGACATCAGATCCAACTCGGGGTCCGCATCGCTCCGCCGGCGACCGACGAAGCCGACGACACTACCGTGCCGCCTTCCGAAAATCCTGCTACCACATCGCC\t*\tORI:Z:MT_H37RV_BRD_V5.ref.fasta;TKK_02_0005.fasta;TKK_02_0006.fasta;TKK_02_0008.fasta\tCRD:Z:MT_H37RV_BRD_V5.ref.fasta\tCRDCTG:Z:MT_H37RV_BRD_V5\tCTG:Z:NZ_KK327777.1;NZ_KK327775.1;MT_H37RV_BRD_V5;NZ_KK350895.1\tSTART:Z:0\n" +
            "L\t1\t+\t2\t+\t0M\n" +
            "S\t2\tAGACACCACAACCGACAACGACGAGATTGATGACAGCGCTGCGGCACGGGGCGATAACCAGCACAGTTGGCCAAGTTACTTCACCGAGCGCCCGCACAATACCGATTCCGCTACCGCTGGCGTAACCAGCCTTAACCGTCGCTACACCTTTGATACGTTCGTTATCGGCGCCTCCAACCGGTTCGCGCACGCCGCCGCCTTGGCGATCGCAGAAGCACCCGCCCGCGCTTACAACCCCCTGTTCATCTGGGGCGA" +
            "GTCCGGTCTCGGCAAGACACACCTGCTACACGCGGCAGGCAACTATGCCCAACGGTTGTTCCCGGGAATGCGGGTCAAATATGTCTCCACCGAGGAATTCACCAACGACTTCATTAACTCGCTCCGCGATGACCGCAAGGTCGCATTCAAACGCAGCTACCGCGACGTAGACGTGCTGTTGGTCGACGACATCCAATTCATTGAAGGCAAAGAGGGTATTCAAGAGGAGTTCTTCCACACCTTCAACACCTTGCACAATGCCAACAAGCAAATCGTCATCTCATCTGACCGCCCACCCAAGCAGCTCGCCACCCTCGAGGACCGGCTGAGAACCCGCTTTGAGTGGGGGCTGATCACTGACGTACAACCACCCGAGCTGGAGACCCGCATCGCCATCTTGCGCAAGAAAGCACAGATGGAACGGCTCGCGGTCCCCGACGATGTCCTCGAACTCATCGCCAGCAGTATCGAACGCAATATCCGTGAACTCGAGGGCGCGCTGATCCGGGTCACCGCGTTCGCCTCATTGAACAAAACACCAATCGACAAAGCGCTGGCCGAGATTGTGCTTCGCGATCTGATCGCCGA" +
            "CGCCAACACCATGCAAATCAGCGCGGCGACGATCATGGCTGCCACCGCCGAATACTTCGACACTACCGTCGAAGAGCTTCGCGGGCCCGGCAAGACCCGAGCACTGGCCCAGTCACGACAGATTGCGATGTACCTGTGTCGTGAGCTCACCGATCTTTCGTTGCCCAAAATCGGCCAAGCGTTCGGCCGTGATCACACAACCGTCATGTACGCCCAACGCAAGATCCTGTCCGAGAT\t*\tORI:Z:MT_H37RV_BRD_V5.ref.fasta;TKK_02_0005.fasta;TKK_02_0006.fasta;TKK_02_0018.fasta;TKK_02_0008.fasta\tCRD:Z:MT_H37RV_BRD_V5.ref.fasta\tCRDCTG:Z:MT_H37RV_BRD_V5\tCTG:Z:NZ_KK327777.1;NZ_KK350906.1;NZ_KK327775.1;MT_H37RV_BRD_V5;NZ_KK350895.1\tSTART:Z:371\n" +
            "L\t2\t+\t3\t+\t0M\n" +
            "L\t2\t+\t4\t+\t0M\n" +
            "S\t3\tC\t*\tORI:Z:TKK_02_0008.fasta\tCRD:Z:TKK_02_0008.fasta\tCRDCTG:Z:NZ_KK327777.1\tCTG:Z:NZ_KK327777.1\tSTART:Z:1451\n" +
            "L\t3\t+\t5\t+\t0M\n" +
            "S\t4\tG\t*\tORI:Z:MT_H37RV_BRD_V5.ref.fasta;TKK_02_0005.fasta;TKK_02_0006.fasta;TKK_02_0018.fasta\tCRD:Z:MT_H37RV_BRD_V5.ref.fasta\tCRDCTG:Z:MT_H37RV_BRD_V5\tCTG:Z:MT_H37RV_BRD_V5;NZ_KK327775.1;NZ_KK350906.1;NZ_KK350895.1\tSTART:Z:1451\n" +
            "L\t4\t+\t5\t+\t0M\n" +
            "S\t5\tGCCGAGCGCCGTGAGGTCTTTGATCACGTCAAAGAACTCACCACTCGCATCCGTCAGCGCTCCAAGCGCTAGCACGGCGTGTTCTTCCGACAACGTTCTT\t*\tORI:Z:MT_H37RV_BRD_V5.ref.fasta;TKK_02_0005.fasta;TKK_02_0006.fasta;TKK_02_0018.fasta;TKK_02_0008.fasta\tCRD:Z:MT_H37RV_BRD_V5.ref.fasta\tCRDCTG:Z:MT_H37RV_BRD_V5\tCTG:Z:NZ_KK327777.1;MT_H37RV_BRD_V5;NZ_KK327775.1;NZ_KK350906.1;NZ_KK350895.1\tSTART:Z:1452\n" +
            "L\t5\t+\t6\t+\t0M\n" +
            "L\t5\t+\t7\t+\t0M\n" +
            "S\t6\tA\t*\tORI:Z:MT_H37RV_BRD_V5.ref.fasta;TKK_02_0005.fasta;TKK_02_0006.fasta;TKK_02_0008.fasta\tCRD:Z:MT_H37RV_BRD_V5.ref.fasta\tCRDCTG:Z:MT_H37RV_BRD_V5\tCTG:Z:NZ_KK327777.1;NZ_KK327775.1;MT_H37RV_BRD_V5;NZ_KK350895.1\tSTART:Z:1552\n" +
            "L\t6\t+\t7\t+\t0M\n" +
            "S\t7\tAAAAAACTTCTCTCTCCCAGGTCACACCAGTCACAGAGATTGGCTGTGAGTGTCGCTGTGCACAAACCGCGCACAGACTCATACAGTCCCGGCGGTTCCGTTCACAACCCACGCCTCATCCCCACCGACCCAACACACACCCCACAG\t*\tORI:Z:MT_H37RV_BRD_V5.ref.fasta;TKK_02_0005.fasta;TKK_02_0006.fasta;TKK_02_0018.fasta;TKK_02_0008.fasta\tCRD:Z:MT_H37RV_BRD_V5.ref.fasta\tCRDCTG:Z:MT_H37RV_BRD_V5\tCTG:Z:NZ_KK327777.1;MT_H37RV_BRD_V5;NZ_KK327775.1;NZ_KK350906.1;NZ_KK350895.1\tSTART:Z:1553\n" +
            "L\t7\t+\t8\t+\t0M\n" +
            "L\t7\t+\t9\t+\t0M\n" +
            "S\t8\tT\t*\tORI:Z:MT_H37RV_BRD_V5.ref.fasta;TKK_02_0018.fasta\tCRD:Z:MT_H37RV_BRD_V5.ref.fasta\tCRDCTG:Z:MT_H37RV_BRD_V5\tCTG:Z:NZ_KK350906.1;MT_H37RV_BRD_V5\tSTART:Z:1700\n" +
            "L\t8\t+\t10\t+\t0M\n" +
            "S\t9\tC\t*\tORI:Z:TKK_02_0005.fasta;TKK_02_0006.fasta;TKK_02_0008.fasta\tCRD:Z:TKK_02_0005.fasta\tCRDCTG:Z:NZ_KK327775.1\tCTG:Z:NZ_KK327777.1;NZ_KK327775.1;NZ_KK350895.1\tSTART:Z:1700\n" +
            "L\t9\t+\t10\t+\t0M";
    private PositionHandler handler;
    private NodeCollection collection;

    @Before
    public void setHandler() {
        SegmentParser parser = new SegmentParser();
        parser.parse(stringToInputStream(file));
        this.collection = parser.getSegmentCollection();
        handler = new PositionHandler(this.collection);
    }

    /**
     * Test calculate position.
     */
    @Test
    public void testCalculatePositions() {
        handler.calculatePositions();
        assertEquals(1,collection.get(1).getId());
    }
    /**
     * Converts a String to an InputStream
     * @param s String
     * @return InputStream of that String.
     */
    public InputStream stringToInputStream(String s) {
        return new ByteArrayInputStream(s.getBytes(StandardCharsets.UTF_8));
    }
}
